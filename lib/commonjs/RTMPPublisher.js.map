{"version":3,"sources":["RTMPPublisher.tsx"],"names":["RTMPModule","NativeModules","RTMPPublisher","ref","onConnectionFailed","onConnectionStarted","onConnectionSuccess","onDisconnect","onNewBitrateReceived","onStreamStateChanged","props","_root","React","useRef","startStream","stopStream","isStreaming","isCameraOnPreview","getPublishURL","hasCongestion","isAudioPrepared","isVideoPrepared","isMuted","mute","unmute","switchCamera","toggleFlash","handleOnConnectionFailed","e","nativeEvent","data","handleOnConnectionStarted","handleOnConnectionSuccess","handleOnDisconnect","handleOnNewBitrateReceived","handleOnStreamStateChanged","scale","savedScale","useEffect","console","log","value","pinchGesture","Gesture","Pinch","onUpdate","onEnd","flex","styles","style","backgroundColor","StyleSheet","create","absolute","position"],"mappings":"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","sourcesContent":["import React, { forwardRef, useImperativeHandle } from 'react';\nimport {\n  Animated,\n  NativeModules,\n  StyleSheet,\n  View,\n  ViewStyle,\n} from 'react-native';\nimport {\n  Gesture,\n  GestureDetector,\n  GestureHandlerRootView,\n} from 'react-native-gesture-handler';\nimport { useSharedValue } from 'react-native-reanimated';\nimport RTMPView, {\n  ConnectionFailedType,\n  ConnectionStartedType,\n  ConnectionSuccessType,\n  DisconnectType,\n  NewBitrateReceivedType,\n  RefNativeRTMPPublisherProps,\n  StreamStateChangedType,\n} from './Component';\nimport type { RTMPPublisherRefProps, StreamState } from './types';\n\nconst RTMPModule = NativeModules.RTMPPublisher;\nexport interface RTMPPublisherProps {\n  style?: ViewStyle;\n  streamURL: string;\n  streamName: string;\n  /**\n   * Determines if preview is displayed as landscape\n   */\n  IsLandscape: boolean;\n  /**\n   * Callback for connection fails on RTMP server\n   */\n  onConnectionFailed?: (data: string) => void;\n  /**\n   * Callback for starting connection to RTMP server\n   */\n  onConnectionStarted?: (data: string) => void;\n  /**\n   * Callback for connection successfully to RTMP server\n   */\n  onConnectionSuccess?: (data: null) => void;\n  /**\n   * Callback for disconnect successfully to RTMP server\n   */\n  onDisconnect?: (data: null) => void;\n  /**\n   * Callback for receiving new bitrate value about stream\n   */\n  onNewBitrateReceived?: (data: number) => void;\n  /**\n   * Alternatively callback for changing stream state\n   * Returns parameter StreamState type\n   */\n  onStreamStateChanged?: (data: StreamState) => void;\n}\n\nconst RTMPPublisher = forwardRef<RTMPPublisherRefProps, RTMPPublisherProps>(\n  (\n    {\n      onConnectionFailed,\n      onConnectionStarted,\n      onConnectionSuccess,\n      onDisconnect,\n      onNewBitrateReceived,\n      onStreamStateChanged,\n      ...props\n    },\n    ref\n  ) => {\n    const _root = React.useRef<RefNativeRTMPPublisherProps>(null);\n\n    const startStream = async () => await RTMPModule.startStream();\n\n    const stopStream = async () => await RTMPModule.stopStream();\n\n    const isStreaming = async () => RTMPModule.isStreaming();\n\n    const isCameraOnPreview = async () => RTMPModule.isCameraOnPreview();\n\n    const getPublishURL = async () => RTMPModule.getPublishURL();\n\n    const hasCongestion = async () => RTMPModule.hasCongestion();\n\n    const isAudioPrepared = async () => RTMPModule.isAudioPrepared();\n\n    const isVideoPrepared = async () => RTMPModule.isVideoPrepared();\n\n    const isMuted = async () => RTMPModule.isMuted();\n\n    const mute = () => RTMPModule.mute();\n\n    const unmute = () => RTMPModule.unmute();\n\n    const switchCamera = () => RTMPModule.switchCamera();\n\n    const toggleFlash = () => RTMPModule.toggleFlash();\n\n    const handleOnConnectionFailed = (e: ConnectionFailedType) => {\n      onConnectionFailed && onConnectionFailed(e.nativeEvent.data);\n    };\n\n    const handleOnConnectionStarted = (e: ConnectionStartedType) => {\n      onConnectionStarted && onConnectionStarted(e.nativeEvent.data);\n    };\n\n    const handleOnConnectionSuccess = (e: ConnectionSuccessType) => {\n      onConnectionSuccess && onConnectionSuccess(e.nativeEvent.data);\n    };\n\n    const handleOnDisconnect = (e: DisconnectType) => {\n      onDisconnect && onDisconnect(e.nativeEvent.data);\n    };\n\n    const handleOnNewBitrateReceived = (e: NewBitrateReceivedType) => {\n      onNewBitrateReceived && onNewBitrateReceived(e.nativeEvent.data);\n    };\n\n    const handleOnStreamStateChanged = (e: StreamStateChangedType) => {\n      onStreamStateChanged && onStreamStateChanged(e.nativeEvent.data);\n    };\n\n    useImperativeHandle(ref, () => ({\n      startStream,\n      stopStream,\n      isStreaming,\n      isCameraOnPreview,\n      getPublishURL,\n      hasCongestion,\n      isAudioPrepared,\n      isVideoPrepared,\n      isMuted,\n      mute,\n      unmute,\n      switchCamera,\n      toggleFlash,\n    }));\n\n    // const _baseScale = new Animated.Value(1);\n    // const _pinchScale = new Animated.Value(1);\n    // var _lastScale = 1;\n\n    // const _onPinchHandlerStateChange = (\n    //   event: HandlerStateChangeEvent<PinchGestureHandlerEventPayload>\n    // ) => {\n    //   console.log('RE');\n    //   console.log({ _lastScale });\n    //   if (\n    //     event.nativeEvent.oldState === State.ACTIVE &&\n    //     event.nativeEvent.numberOfPointers === 2\n    //   ) {\n    //     _lastScale *= event.nativeEvent.scale;\n    //     _lastScale < 1 && (_lastScale = 1);\n    //     _lastScale > 3 && (_lastScale = 3);\n    //     _baseScale.setValue(_lastScale);\n    //     _pinchScale.setValue(1);\n    //   }\n    // };\n\n    // const [viewDimension, setViewDimension] = React.useState<LayoutRectangle>({\n    //   width: 0,\n    //   height: 0,\n    //   x: 0,\n    //   y: 0,\n    // });\n\n    const scale = useSharedValue(1);\n    const savedScale = useSharedValue(1);\n\n    React.useEffect(() => {\n      console.log({ scale: scale.value, savedScale: savedScale.value });\n    }, [scale.value, savedScale.value]);\n\n    const pinchGesture = Gesture.Pinch()\n      .onUpdate((e) => {\n        scale.value = savedScale.value * e.scale;\n      })\n      .onEnd(() => {\n        savedScale.value = scale.value;\n        // _root.current?.setNativeProps({\n        //   zoom: `${scale.value}`,\n        // });\n      });\n\n    // const animatedStyle = useAnimatedStyle(() => ({\n    //   transform: [{ scale: scale.value }],\n    // }));\n\n    return (\n      <GestureHandlerRootView style={{ flex: 1 }}>\n        <View style={[styles.flex, props.style]}>\n          {/* <PinchGestureHandler\n          onGestureEvent={(event) => {\n            console.log({ event });\n            _root.current?.setNativeProps({\n              zoom: `${_lastScale * event.nativeEvent.scale}`,\n            });\n          }}\n          onHandlerStateChange={_onPinchHandlerStateChange}\n        > */}\n          <GestureDetector gesture={pinchGesture}>\n            <Animated.View\n              style={[styles.flex, { backgroundColor: 'red' }]}\n              collapsable={false}\n            >\n              <RTMPView\n                ref={_root as any}\n                {...props}\n                onDisconnect={handleOnDisconnect}\n                onConnectionFailed={handleOnConnectionFailed}\n                onConnectionStarted={handleOnConnectionStarted}\n                onConnectionSuccess={handleOnConnectionSuccess}\n                onNewBitrateReceived={handleOnNewBitrateReceived}\n                onStreamStateChanged={handleOnStreamStateChanged}\n              />\n            </Animated.View>\n          </GestureDetector>\n          {/* </PinchGestureHandler> */}\n        </View>\n      </GestureHandlerRootView>\n    );\n  }\n);\n\n{\n  /* <GestureHandlerRootView\n        style={[styles.flex, props.style]}\n        onLayout={(event) => {\n          setViewDimension(event.nativeEvent.layout);\n        }}\n      ></GestureHandlerRootView> */\n}\n\nconst styles = StyleSheet.create({\n  absolute: { position: 'absolute' },\n  flex: { flex: 1 },\n});\n\nexport default RTMPPublisher;\n"]}